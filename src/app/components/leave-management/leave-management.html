<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>Leave Management</h1>
  </div>

  <!-- Loading Spinner -->
  @if (isLoading) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
  }

  <!-- Error Message -->
  @if (error) {
  <div class="error-message">
    {{ error }}
  </div>
  }

  <!-- Leave Requests Table -->
  @if (!isLoading && !error) {
  <div class="table-container">
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Employee Name</th>
            <th>Department</th>
            <th>Type</th>
            <th>Duration</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (request of leaveRequests; track request.id) {
          <tr>
            <td>{{ request.employeeId }}</td>
            <td>{{ request.createdBy }}</td>
            <td class="leave-type">{{ getLeaveTypeLabel(request.leaveTypeID) }}</td>
            <td>
              <div class="duration">
                <span class="duration-days">{{
                  getDuration(request.startDate, request.endDate)
                }}</span>
                <span class="duration-dates"
                  >{{ request.startDate }} to {{ request.endDate }}</span
                >
              </div>
            </td>
            <td>
              <div
                class="reason-cell"
                [matTooltip]="request.reason"
                matTooltipPosition="above"
              >
                {{ request.reason }}
              </div>
            </td>
            <td>
              <span
                class="status-chip"
                [class.status-approved]="request.status === StatusEnum.Accepted"
                [class.status-rejected]="request.status === StatusEnum.Rejected"
                [class.status-pending]="request.status === StatusEnum.Pending"
              >
                {{ getStatusLabel(request.status) }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                @if (request.status === StatusEnum.Pending) {
                <button
                  class="btn btn-approve"
                  (click)="approveLeave(request.id)"
                  matTooltip="Approve Leave"
                >
                  <mat-icon>check</mat-icon>
                  <span>Approve</span>
                </button>
                <button
                  class="btn btn-reject"
                  (click)="rejectLeave(request.id)"
                  matTooltip="Reject Leave"
                >
                  <mat-icon>close</mat-icon>
                  <span>Reject</span>
                </button>
                } @else {
                <div
                  class="action-info"
                  [class.approved-info]="request.status === StatusEnum.Accepted"
                  [class.rejected-info]="request.status === StatusEnum.Rejected"
                  [matTooltip]="request.reason"
                >
                  <mat-icon>{{
                    request.status === StatusEnum.Accepted
                      ? "check_circle"
                      : "cancel"
                  }}</mat-icon>
                  <div class="action-details">
                    <span class="action-by">{{ request.updatedBy || 'N/A' }}</span>
                    <span class="action-date">{{
                      formatDate(request.updatedDateTime)
                    }}</span>
                  </div>
                </div>
                }
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  }
</div>
